(()=>{"use strict";const e=e=>"Escape"===e.key||"Esc"===e.key,t=document.querySelector(".big-picture"),r=t.querySelector(".big-picture__cancel"),c=t.querySelector(".big-picture__img img"),n=t.querySelector(".social__caption"),o=t.querySelector(".likes-count"),s=t.querySelector(".comments-count"),a=t.querySelector(".number-comments-show"),l=t.querySelector(".social__comments"),i=t.querySelector(".comments-loader"),d=document.querySelector("#comment").content.querySelector(".social__comment");let u,m,g;const v=()=>{const e=document.createDocumentFragment();u.slice(m,g).forEach((t=>{const r=(e=>{const t=d.cloneNode(!0),r=t.querySelector(".social__picture");return r.src=e.avatar,r.alt=e.name,t.querySelector(".social__text").textContent=e.message,t})(t);e.appendChild(r)})),l.appendChild(e)},y=()=>{m=g,g=m+5,g>=u.length?(i.classList.add("hidden"),a.textContent=u.length,i.removeEventListener("click",y)):a.textContent=g,v()},p=()=>{i.removeEventListener("click",y),t.classList.add("hidden"),document.body.classList.remove("modal-open")},h=t=>{e(t)&&(t.preventDefault(),p(),document.removeEventListener("keydown",h))};r.addEventListener("click",(()=>{p()})),t.addEventListener("click",(e=>{e.target.classList.contains("overlay")&&p()}));const _=document.querySelector(".img-filters"),S=_.querySelectorAll(".img-filters__button"),k=document.querySelector(".pictures"),q=document.querySelector("#picture").content.querySelector(".picture"),L=e=>{k.querySelectorAll(".picture").forEach((e=>e.remove()));const r=(e=>{switch(document.querySelector(".img-filters__button--active").id){case"filter-random":return(t=e,[...t].sort((()=>Math.random()-.5))).slice(0,10);case"filter-discussed":return e.slice().sort(((e,t)=>t.comments.length-e.comments.length));case"filter-default":default:return e}var t})(e),d=document.createDocumentFragment();r.forEach((e=>{const r=(e=>{const t=q.cloneNode(!0);return t.querySelector(".picture__img").src=e.url,t.querySelector(".picture__likes").textContent=e.likes,t.querySelector(".picture__comments").textContent=e.comments.length,t.dataset.id=e.id,t})(e);r.addEventListener("click",(r=>{r.preventDefault(),(e=>{c.src=e.url,n.textContent=e.description,o.textContent=e.likes,u=e.comments,m=0,g=m+5,s.textContent=u.length,l.textContent="",g>=u.length?(i.classList.add("hidden"),a.textContent=u.length):(i.classList.remove("hidden"),a.textContent=g,i.addEventListener("click",y)),v(),document.addEventListener("keydown",h),document.body.classList.add("modal-open"),t.classList.remove("hidden")})(e)})),d.appendChild(r)})),k.appendChild(d)},f=document.querySelector("main"),E=document.querySelector("#error-app").content.querySelector(".error"),b=document.querySelector("#error").content.querySelector(".error"),w=document.querySelector("#success").content.querySelector(".success"),C=t=>{const r=t.cloneNode(!0),c=r.querySelector(".button-close"),n=r.querySelector(".button-reboot");if(c){const t=c=>{e(c)&&(c.preventDefault(),r.remove(),document.removeEventListener("keydown",t))};document.addEventListener("keydown",t),c.addEventListener("click",(()=>{r.remove(),document.removeEventListener("keydown",t)})),r.addEventListener("click",(e=>{e.target===r&&r.remove()}))}n&&n.addEventListener("click",(()=>{location.reload()})),f.appendChild(r)},x=()=>{C(b)},M=()=>{C(w)},N={MIN:0,MAX:1,STEP:.1},$={MIN:0,MAX:1,STEP:.1},A={MIN:0,MAX:100,STEP:1},D={MIN:0,MAX:3,STEP:.1},T={MIN:1,MAX:3,STEP:.1};let P;const I=["image/jpeg","image/png","image/webp","image/gif"],U=/^[a-z0-9#]*$/i,X={check:e=>e.some((e=>"#"!==e[0])),message:"Хэш-тег должен начинается с символа #."},F={check:e=>e.some((e=>1===e.length&&"#"===e)),message:"Хеш-тег не может состоять только из #."},j={check:e=>e.length>5,message:"Нельзя указать больше 5 хэш-тегов."},z={check:e=>new Set(e).size!==e.length,message:"Один и тот же хэш-тег не может быть использован дважды."},O={check:e=>e.some((e=>e.length>20)),message:"Максимальная длина одного хэш-тега 20 символов, включая #."},R={check:e=>e.some((e=>!U.test(e))),message:"Хеш-тег должен состоять только из буквы и чисел."},V=document.querySelector(".img-upload"),B=V.querySelector(".img-upload__form"),G=V.querySelector(".img-upload__input"),H=V.querySelector(".img-upload__overlay"),J=V.querySelector(".img-upload__preview img"),K=V.querySelector(".img-upload__cancel"),Q=V.querySelector(".text__hashtags"),W=V.querySelector(".text__description"),Y=()=>{document.removeEventListener("keydown",Z),B.reset(),P(),H.classList.add("hidden"),document.body.classList.remove("modal-open")},Z=t=>{const r=document.activeElement;e(t)&&r!==Q&&r!==W&&(t.preventDefault(),Y())};var ee,te;K.addEventListener("click",(()=>{Y()})),B.addEventListener("submit",(e=>{var t,r,c;e.preventDefault(),t=M,r=x,c=new FormData(e.target),fetch("https://22.javascript.pages.academy/kekstagram",{method:"POST",type:"multipart/form-data",body:c}).then((e=>{e.ok?t():r()})).catch((()=>r())),Y()})),H.addEventListener("mousedown",(e=>{e.target===H&&0===e.button&&Y()})),((e,t,r)=>{e.addEventListener("change",(e=>{const r=e.target.files[0];if(I.some((e=>r.type===e))){const e=new FileReader;e.addEventListener("load",(()=>{t.src=e.result,document.addEventListener("keydown",Z),H.classList.remove("hidden"),document.body.classList.add("modal-open")})),e.readAsDataURL(r)}}))})(G,J),((e,t)=>{const r=e.querySelector(".img-upload__scale"),c=r.querySelector(".scale__control--smaller"),n=r.querySelector(".scale__control--bigger"),o=r.querySelector(".scale__control--value"),s=(e,r)=>{e!==r&&(o.value=`${r}%`,t.style.transform=`scale(${r/100})`)};r.addEventListener("click",(e=>{const t=parseInt(o.value);switch(e.target){case c:t>25&&s(t,t-25);break;case n:t<100&&s(t,t+25);break;case o:s(t,100)}}))})(V,J),((e,t)=>{const r=e.querySelector(".img-upload__effects"),c=e.querySelector(".effect-level__value"),n=e.querySelector(".effect-level__slider"),o=(e,r)=>{const n=parseFloat(e[r]);c.value=n,t.style.setProperty("--filter-value",n)},s=({MIN:e,MAX:t,STEP:r})=>{const c={start:t,step:r,connect:"lower",range:{min:e,max:t}};n.noUiSlider?n.noUiSlider.updateOptions(c):(noUiSlider.create(n,c),n.noUiSlider.on("update",o))};P=()=>{n.noUiSlider&&n.noUiSlider.destroy(),t.className=null,t.style=null,c.value=null},r.addEventListener("change",(e=>{switch(t.className=`effects__preview--${e.target.value}`,e.target.value){case"none":P();break;case"chrome":s(N);break;case"sepia":s($);break;case"marvin":s(A);break;case"phobos":s(D);break;case"heat":s(T)}}))})(V,J),Q.addEventListener("input",(e=>{let t="";const r=e.target.value.toLowerCase().split(" ").filter((e=>""!==e));X.check(r)&&(t+=`${X.message}\n`),F.check(r)&&(t+=`${F.message}\n`),j.check(r)&&(t+=`${j.message}\n`),z.check(r)&&(t+=`${z.message}\n`),O.check(r)&&(t+=`${O.message}\n`),R.check(r)&&(t+=`${R.message}\n`),e.target.setCustomValidity(t)})),ee=e=>{var t;L(e),t=((e,t)=>{let r;return()=>{r&&window.clearTimeout(r),r=setTimeout(e,500)}})((()=>L(e))),_.classList.remove("img-filters--inactive"),_.addEventListener("click",(e=>{e.target.classList.contains("img-filters__button")&&!e.target.classList.contains("img-filters__button--active")&&(S.forEach((t=>{t.classList.remove("img-filters__button--active"),e.target.classList.add("img-filters__button--active")})),t())}))},te=()=>{C(E)},fetch("https://22.javascript.pages.academy/kekstagram/data").then((e=>{if(e.ok)return e.json();throw new Error})).then((e=>ee(e))).catch((()=>te()))})();
//# sourceMappingURL=main.bundle.js.map